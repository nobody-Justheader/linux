#
# ShadowOS Privacy & Security Kernel Configuration Fragment
# This file is merged with architecture-specific defconfigs
# to create the final privacy-hardened kernel configuration.
#

# =============================================================================
# SECURITY FRAMEWORK
# =============================================================================

# Core security infrastructure
CONFIG_SECURITY=y
CONFIG_SECURITYFS=y
CONFIG_SECURITY_NETWORK=y
CONFIG_SECURITY_INFINIBAND=y
CONFIG_SECURITY_PATH=y

# LSM (Linux Security Modules) - Stack multiple for defense in depth
CONFIG_SECURITY_APPARMOR=y
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SMACK=y
CONFIG_SECURITY_TOMOYO=y
CONFIG_SECURITY_YAMA=y
CONFIG_SECURITY_LOADPIN=y
CONFIG_SECURITY_SAFESETID=y
CONFIG_SECURITY_LOCKDOWN_LSM=y
CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y
CONFIG_LOCK_DOWN_KERNEL_FORCE_CONFIDENTIALITY=y
CONFIG_SECURITY_LANDLOCK=y

# AppArmor as default (user-friendly + secure)
CONFIG_DEFAULT_SECURITY_APPARMOR=y

# LSM stacking order
CONFIG_LSM="landlock,lockdown,yama,loadpin,safesetid,integrity,apparmor,selinux,smack,tomoyo,bpf"

# =============================================================================
# INTEGRITY MEASUREMENT ARCHITECTURE (IMA)
# =============================================================================

CONFIG_INTEGRITY=y
CONFIG_INTEGRITY_SIGNATURE=y
CONFIG_INTEGRITY_ASYMMETRIC_KEYS=y
CONFIG_INTEGRITY_TRUSTED_KEYRING=y
CONFIG_INTEGRITY_AUDIT=y
CONFIG_IMA=y
CONFIG_IMA_MEASURE_PCR_IDX=10
CONFIG_IMA_LSM_RULES=y
CONFIG_IMA_APPRAISE=y
CONFIG_IMA_APPRAISE_BOOTPARAM=y
CONFIG_IMA_APPRAISE_BUILD_POLICY=y
CONFIG_IMA_APPRAISE_REQUIRE_FIRMWARE_SIGS=y
CONFIG_IMA_APPRAISE_REQUIRE_KEXEC_SIGS=y
CONFIG_IMA_APPRAISE_REQUIRE_MODULE_SIGS=y
CONFIG_IMA_APPRAISE_REQUIRE_POLICY_SIGS=y
CONFIG_EVM=y
CONFIG_EVM_ATTR_FSUUID=y

# =============================================================================
# MEMORY HARDENING
# =============================================================================

# Stack protection
CONFIG_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_INIT_STACK_ALL_ZERO=y
CONFIG_KSTACK_ERASE=y

# Heap initialization
CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y
CONFIG_INIT_ON_FREE_DEFAULT_ON=y

# Register clearing
CONFIG_ZERO_CALL_USED_REGS=y

# Bounds checking
CONFIG_FORTIFY_SOURCE=y
CONFIG_HARDENED_USERCOPY=y
CONFIG_HARDENED_USERCOPY_DEFAULT_ON=y

# Data structure hardening
CONFIG_LIST_HARDENED=y
CONFIG_BUG_ON_DATA_CORRUPTION=y

# Structure layout randomization
CONFIG_RANDSTRUCT_FULL=y

# Memory permissions
CONFIG_STRICT_KERNEL_RWX=y
CONFIG_STRICT_MODULE_RWX=y

# =============================================================================
# ADDRESS SPACE LAYOUT RANDOMIZATION (ASLR)
# =============================================================================

CONFIG_RANDOMIZE_BASE=y
CONFIG_RANDOMIZE_MEMORY=y

# =============================================================================
# RESTRICT INFORMATION LEAKS
# =============================================================================

# Restrict dmesg access
CONFIG_SECURITY_DMESG_RESTRICT=y

# Restrict /proc/pid/mem access
CONFIG_PROC_MEM_NO_FORCE=y

# Hide kernel symbols
CONFIG_KALLSYMS=y
# CONFIG_KALLSYMS_ALL is not set

# =============================================================================
# DISABLE DEBUG FEATURES (Production)
# =============================================================================

# Disable kexec (can bypass security)
# CONFIG_KEXEC is not set
# CONFIG_KEXEC_FILE is not set
# CONFIG_KEXEC_SIG is not set

# Disable hibernation (cold boot attack vector)
# CONFIG_HIBERNATION is not set

# Disable debugging
# CONFIG_DEBUG_KERNEL is not set
# CONFIG_DEBUG_INFO is not set
# CONFIG_DEBUG_FS is not set
# CONFIG_KPROBES is not set
# CONFIG_FTRACE is not set
# CONFIG_TRACING is not set
# CONFIG_PROFILING is not set

# Disable live patching
# CONFIG_LIVEPATCH is not set

# =============================================================================
# MODULE SECURITY
# =============================================================================

CONFIG_MODULES=y
CONFIG_MODULE_SIG=y
CONFIG_MODULE_SIG_FORCE=y
CONFIG_MODULE_SIG_ALL=y
CONFIG_MODULE_SIG_SHA512=y
CONFIG_MODULE_SIG_HASH="sha512"

# =============================================================================
# CRYPTOGRAPHY
# =============================================================================

CONFIG_CRYPTO=y
CONFIG_CRYPTO_USER=y
CONFIG_CRYPTO_USER_API=y
CONFIG_CRYPTO_USER_API_HASH=y
CONFIG_CRYPTO_USER_API_SKCIPHER=y
CONFIG_CRYPTO_USER_API_RNG=y
CONFIG_CRYPTO_USER_API_AEAD=y

# Modern symmetric ciphers
CONFIG_CRYPTO_AES=y
CONFIG_CRYPTO_CHACHA20=y
CONFIG_CRYPTO_CHACHA20POLY1305=y
CONFIG_CRYPTO_SERPENT=y
CONFIG_CRYPTO_TWOFISH=y

# Block cipher modes
CONFIG_CRYPTO_XTS=y
CONFIG_CRYPTO_CTR=y
CONFIG_CRYPTO_GCM=y
CONFIG_CRYPTO_CCM=y

# Hash algorithms
CONFIG_CRYPTO_SHA256=y
CONFIG_CRYPTO_SHA512=y
CONFIG_CRYPTO_SHA3=y
CONFIG_CRYPTO_BLAKE2B=y
CONFIG_CRYPTO_BLAKE2S=y
CONFIG_CRYPTO_HMAC=y

# MAC algorithms
CONFIG_CRYPTO_POLY1305=y
CONFIG_CRYPTO_GHASH=y

# Random number generation
CONFIG_CRYPTO_RNG=y
CONFIG_CRYPTO_DRBG=y
CONFIG_CRYPTO_DRBG_HASH=y
CONFIG_CRYPTO_DRBG_CTR=y
CONFIG_CRYPTO_JITTERENTROPY=y

# Asymmetric ciphers
CONFIG_CRYPTO_RSA=y
CONFIG_CRYPTO_ECDH=y
CONFIG_CRYPTO_ECDSA=y
CONFIG_CRYPTO_ECRDSA=y
CONFIG_CRYPTO_CURVE25519=y

# Compression
CONFIG_CRYPTO_LZO=y
CONFIG_CRYPTO_LZ4=y
CONFIG_CRYPTO_ZSTD=y

# =============================================================================
# NETWORKING SECURITY
# =============================================================================

CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NF_CONNTRACK=y
CONFIG_NF_TABLES=y
CONFIG_NF_TABLES_INET=y
CONFIG_NFT_REJECT=y
CONFIG_NFT_MASQ=y
CONFIG_NFT_NAT=y

# IPsec / VPN support
CONFIG_XFRM=y
CONFIG_XFRM_USER=y
CONFIG_NET_KEY=y
CONFIG_INET_ESP=y
CONFIG_INET_ESP_OFFLOAD=y
CONFIG_INET6_ESP=y
CONFIG_INET6_ESP_OFFLOAD=y

# WireGuard
CONFIG_WIREGUARD=y

# TLS offload
CONFIG_TLS=y
CONFIG_TLS_DEVICE=y

# Network namespaces (for containers)
CONFIG_NET_NS=y

# =============================================================================
# WIRELESS / MONITOR MODE SUPPORT
# =============================================================================

CONFIG_WIRELESS=y
CONFIG_CFG80211=y
CONFIG_MAC80211=y
CONFIG_MAC80211_MESH=y

# Packet injection support
CONFIG_PACKET=y
CONFIG_PACKET_DIAG=y

# Raw socket access
CONFIG_UNIX=y
CONFIG_UNIX_DIAG=y

# =============================================================================
# BLOCK DEVICE / ENCRYPTION
# =============================================================================

# Device mapper for LUKS
CONFIG_BLK_DEV_DM=y
CONFIG_DM_CRYPT=y
CONFIG_DM_VERITY=y
CONFIG_DM_VERITY_VERIFY_ROOTHASH_SIG=y
CONFIG_DM_VERITY_FEC=y

# Loop device (for container images)
CONFIG_BLK_DEV_LOOP=y

# =============================================================================
# FILESYSTEM SECURITY
# =============================================================================

# Extended attributes for security labels
CONFIG_TMPFS_XATTR=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_EXT4_FS_SECURITY=y
CONFIG_F2FS_FS_SECURITY=y
CONFIG_SQUASHFS=y
CONFIG_SQUASHFS_XZ=y
CONFIG_SQUASHFS_ZSTD=y
CONFIG_OVERLAY_FS=y

# FUSE for VeraCrypt
CONFIG_FUSE_FS=y

# =============================================================================
# USB SUPPORT
# =============================================================================

CONFIG_USB_SUPPORT=y
CONFIG_USB=y
CONFIG_USB_STORAGE=y

# USB WiFi adapter support
CONFIG_USB_NET_DRIVERS=y
CONFIG_USB_RTL8152=y

# =============================================================================
# GPU SUPPORT (for hashcat)
# =============================================================================

# Enable DRM for GPU access
CONFIG_DRM=y
CONFIG_DRM_AMDGPU=m
CONFIG_DRM_NOUVEAU=m
CONFIG_DRM_I915=m

# =============================================================================
# AUDIT
# =============================================================================

CONFIG_AUDIT=y
CONFIG_AUDITSYSCALL=y
CONFIG_AUDIT_ARCH=y

# =============================================================================
# NAMESPACES (for sandboxing)
# =============================================================================

CONFIG_NAMESPACES=y
CONFIG_UTS_NS=y
CONFIG_IPC_NS=y
CONFIG_USER_NS=y
CONFIG_PID_NS=y
CONFIG_NET_NS=y
CONFIG_CGROUP_NS=y

# Seccomp for syscall filtering
CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y
