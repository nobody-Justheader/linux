# ShadowOS GRUB Configuration
# Auto-detects installation media and boots in most secure mode
#
# USB Drive → Hidden encrypted boot
# ISO/DVD   → RAM-only live mode

set timeout=0
set default=0

# Detect boot media type
if [ -f /.shadow/header.bin ] || [ -f ($root)/.shadow/header.bin ]; then
    # USB with hidden partition detected - encrypted boot
    set shadowos_mode="encrypted"
else
    # Live media - RAM-only mode
    set shadowos_mode="live"
fi

# Single entry - always stealth mode
menuentry "ShadowOS" {
    if [ "$shadowos_mode" = "encrypted" ]; then
        # Hidden encrypted boot
        linux /boot/vmlinuz shadowboot quiet splash loglevel=0 noswap
        initrd /boot/initramfs.img
    else
        # Live RAM-only mode
        linux /boot/vmlinuz boot=live toram quiet splash loglevel=0 noswap
        initrd /boot/initramfs.img
    fi
}
